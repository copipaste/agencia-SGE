<div class="container mt-4">
  <div class="header">
    <h1>Gesti√≥n de Ventas</h1>
    <div class="header-actions">
      <app-export-buttons
        [data]="filteredVentas"
        [columns]="exportColumns"
        filename="ventas"
        printTitle="Listado de Ventas"
      ></app-export-buttons>
      <button class="btn-primary" (click)="nuevaVenta()">
        <span class="icon">‚ûï</span>
        Nueva Venta
      </button>
    </div>
  </div>

  <div class="search-bar">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()"
      (ngModelChange)="onSearch()"
      placeholder="Buscar por cliente, agente o estado..."
      class="search-input"
    />
    <button class="btn-search" (click)="onSearch()">üîç Buscar</button>
    <button class="btn-clear" (click)="clearSearch()" *ngIf="searchTerm || activeFilters && Object.keys(activeFilters).length > 0">
      ‚úñ Limpiar Todo
    </button>
  </div>

  <!-- Panel de Filtros Avanzados -->
  <app-filter-panel
    [filters]="filterOptions"
    (filterChange)="onFilterChange($event)"
    (clearFilters)="onClearFilters()"
  ></app-filter-panel>

  <div *ngIf="loading" class="text-center loading-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="loading-text">Cargando ventas...</p>
  </div>

  <div *ngIf="!loading && ventas.length === 0" class="empty-state">
    <i class="bi bi-inbox empty-icon"></i>
    <h4>No hay ventas registradas</h4>
    <p>Comienza creando tu primera venta</p>
    <button class="btn btn-primary" (click)="nuevaVenta()">
      <i class="bi bi-plus-circle"></i> Crear Primera Venta
    </button>
  </div>

  <div *ngIf="!loading && ventas.length > 0" class="table-container">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th class="th-fecha">FECHA</th>
            <th class="th-cliente">CLIENTE</th>
            <th class="th-agente">AGENTE</th>
            <th class="th-monto">MONTO TOTAL</th>
            <th class="th-estado">ESTADO</th>
            <th class="th-metodo">M√âTODO PAGO</th>
            <th class="th-acciones">ACCIONES</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let venta of paginatedVentas" class="table-row">
            <td class="td-fecha">
              <i class="bi bi-calendar3"></i>
              {{ venta.fechaVenta | date:'dd/MM/yyyy' }}
            </td>
            <td class="td-cliente">
              <i class="bi bi-person-fill"></i>
              {{ getClienteNombre(venta) }}
            </td>
            <td class="td-agente">
              <i class="bi bi-person-badge"></i>
              {{ getAgenteNombre(venta) }}
            </td>
            <td class="td-monto">
              <span class="monto-value">{{ venta.montoTotal | currency }}</span>
            </td>
            <td class="td-estado">
              <span class="badge" [ngClass]="getEstadoBadgeClass(venta.estadoVenta)">
                {{ venta.estadoVenta }}
              </span>
            </td>
            <td class="td-metodo">
              <i class="bi" [ngClass]="{
                'bi-cash-stack': venta.metodoPago === 'Efectivo',
                'bi-credit-card': venta.metodoPago === 'Tarjeta',
                'bi-bank': venta.metodoPago === 'Transferencia'
              }"></i>
              {{ venta.metodoPago }}
            </td>
            <td class="td-acciones">
              <div class="btn-group">
                <button class="btn btn-sm btn-info" (click)="viewVenta(venta.id)" title="Ver detalles">
                  <i class="bi bi-eye"></i>
                  <span class="btn-text">Ver</span>
                </button>
                <button class="btn btn-sm btn-warning" (click)="editVenta(venta.id)" title="Editar">
                  <i class="bi bi-pencil"></i>
                  <span class="btn-text">Editar</span>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteVenta(venta.id)" title="Eliminar">
                  <i class="bi bi-trash"></i>
                  <span class="btn-text">Eliminar</span>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    <div class="pagination-container" *ngIf="filteredVentas.length > 0">
      <div class="pagination-info">
        Mostrando {{ (currentPage - 1) * itemsPerPage + 1 }} 
        a {{ Math.min(currentPage * itemsPerPage, filteredVentas.length) }} 
        de {{ filteredVentas.length }} ventas
      </div>
      
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          (click)="previousPage()" 
          [disabled]="currentPage === 1"
          title="P√°gina anterior"
        >
          ‚¨ÖÔ∏è Anterior
        </button>
        
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="pagination-btn page-number"
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page }}
        </button>
        
        <button 
          class="pagination-btn" 
          (click)="nextPage()" 
          [disabled]="currentPage === totalPages"
          title="P√°gina siguiente"
        >
          Siguiente ‚û°Ô∏è
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Confirmaci√≥n -->
<app-confirm-dialog
  [show]="showConfirmDialog"
  [data]="confirmDialogData"
  (confirm)="confirmDeleteVenta()"
  (cancel)="cancelDeleteVenta()"
></app-confirm-dialog>
